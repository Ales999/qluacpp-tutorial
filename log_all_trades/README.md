# Протоколирование обезличенных сделок (alltrade) #

Плагин сохраняет информацию из сделок, полученных по коллбеку **OnAllTrade** в текстовой файл.
Этот пример иллюстрирует использование коллбека OnAllTrade и простую технику написания многопоточного плагина для Quik.

## Описание работы ##

Плагин сохраняет некоторые поля из данных о произошедших сделках: номер сделки, код инструмента, количество, объем -
полученных по коллбеку OnAllTrade (подробнее об этих данных см. *qlua.chm*). Данные сохраняются в файл *all_trade_log.txt"
текущей директории (директория, откуда запускался info.exe). В документации QLUA делается предупреждения, что
функции обратного вызова происходят на основном потоке терминала, поэтому не следует блокировать исполнение надолго.
Традиционно в таком случае используется отдельный поток обработки данных, что влечет за собой использования того или иного
механизма синхронизации. Как правило, применяется тот или иной вид локинга (мьютексы и проч.). В этом примере
демонстрируется другой подход: использование lock-free двухпоточной структуры данных (reader writer queue).
Обработчик коллбека OnAllTrade сохраняет данные на очереди, в то время как отдельный поток сохраняет информацию каждую минуту.
Итоговый файл содержит записи, где первые два поля, предшествующие данным из торговой системы - время
получения информации и время сохранения информации.
